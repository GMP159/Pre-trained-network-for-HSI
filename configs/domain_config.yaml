# Domain Configuration for Cross-Domain HSI Pretraining
# Updated with actual metadata from inspection

# =============================================================================
# DOMAIN DEFINITIONS
# =============================================================================

domains:
  coffee:
    id: 0
    name: "Coffee Beans Quality"
    description: "Coffee bean classification and quality assessment"
    data_path: "data/coffee"
    num_files: 3
    
    # Actual spectral characteristics
    spectral_range: [968.37, 2499.83]  # nm (from metadata)
    num_bands: 256
    image_size: [2773, 320]  # Average: 2773×320 and 2818×320
    key_wavelengths: [1400, 1900, 2200]  # Important absorption peaks
    
    # Data characteristics
    data_type: "float32"
    value_range: [0.0, 2.0]
    typical_mean: 0.054
    typical_std: 0.073
    
    # Cropping parameters (adjust after visual inspection)
    crop_region:
      top: 1508
      bottom: 2773
      left: 0
      right: 320
    variance_threshold: 0.04

    masking_wavelength_range:
      enabled: true
      wavelength_range: [1000, 1200]
    
    # Background filtering
    variance_threshold: 0.04
    min_useful_ratio: 0.30
    
    # Domain adapter settings
    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1

  # grapes:
  #   id: 1
  #   name: "Grape Classification"
  #   description: "Grape variety and ripeness assessment"
  #   data_path: "data/grapes/grape"
  #   num_files: 1
    
  #   spectral_range: [967.18, 2499.30]
  #   num_bands: 256
  #   image_size: [310, 320]
  #   key_wavelengths: [1200, 1600, 2000]
    
  #   data_type: "float32"
  #   value_range: [0.0, 2.0]
  #   typical_mean: 0.028
  #   typical_std: 0.042
    
  #   crop_region:
  #     top: 152     # ✓ Already determined by you
  #     bottom: 262
  #     left: 80
  #     right: 190
  #   variance_threshold: 0.05

  #   masking_wavelength_range:
  #     enabled: true
  #     wavelength_range: [1000, 1200]
    
  #   variance_threshold: 0.05
  #   min_useful_ratio: 0.30
    
  #   adapter:
  #     input_dim: 128
  #     hidden_dim: 64
  #     output_dim: 128
  #     dropout: 0.1


  grapes:
    id: 1
    name: "Grape Classification"
    description: "Grape variety and ripeness assessment"
    data_path: "data/grapes/grape"
    num_files: 2

    file_list:
      - name: "JKI_Bluestar_01_2016-09-13T170746_SWIR.hdr"
        crop_region:
          top: 152
          bottom: 262
          left: 80
          right: 190
        variance_threshold: 0.05
        wavelength_range: [1000, 1200]

      - name: "JKI_Bluestar_01_2016-09-13T170746_VNIR.hdr"
        crop_region:
          top: 92
          bottom: 472
          left: 417
          right: 1016
        variance_threshold: 0.05
        wavelength_range: [700, 1200]
        

    spectral_range: [967.18, 2499.30]
    num_bands: 256
    image_size: [310, 320]
    key_wavelengths: [1200, 1600, 2000]

    data_type: "float32"
    value_range: [0.0, 2.0]
    typical_mean: 0.028
    typical_std: 0.042

    masking_wavelength_range:
      enabled: true
      wavelength_range: [1000, 1200]

    min_useful_ratio: 0.30

    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1




  pottery:
    id: 2
    name: "Ancient Pottery Analysis"
    description: "Archaeological pottery composition and dating"
    data_path: "data/archiology"
    num_files: 3
    
    spectral_range: [967.18, 2499.30]
    num_bands: 256
    image_size: [390, 320]  # Typical (varies: 390, 360, 350)
    key_wavelengths: [1500, 2000, 2300]
    
    data_type: "uint16"  # NOTE: Different from coffee/grapes!
    value_range: [0, 65535]
    typical_mean: 3176.0  # Average of the 3 files
    typical_std: 6138.0
    
    # Will need normalization to [0,1] range
    normalize_uint16: true
    
    crop_region:
      top: 109
      bottom: 346
      left: 0
      right: 320
    variance_threshold: 0.01

    masking_wavelength_range:
      enabled: true
      wavelength_range: [980, 2200]
    
    variance_threshold: 0.01
    min_useful_ratio: 0.25
    
    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1

  # sugar:
  #   id: 3
  #   name: "Sugar Compounds"
  #   description: "Sugar type discrimination (D-Galactose, D-Glucose, D-Fructose)"
  #   data_path: "data/sugar"
  #   num_files: 1
    
  #   spectral_range: [967.18, 2499.30]
  #   num_bands: 256
  #   image_size: [2589, 320]
  #   key_wavelengths: [1450, 1900, 2100]
    
  #   data_type: "uint16"  # NOTE: Needs normalization
  #   value_range: [0, 65535]
  #   typical_mean: 10816.0
  #   typical_std: 10973.0
    
  #   normalize_uint16: true
    
  #   crop_region:
  #     top: 1255
  #     bottom: 2589
  #     left: 0
  #     right: 320
  #   variance_threshold: 0.05

  #   masking_wavelength_range:
  #     enabled: true
  #     wavelength_range: [980, 1800]
    
  #   variance_threshold: 0.05
  #   min_useful_ratio: 0.35
    
  #   adapter:
  #     input_dim: 128
  #     hidden_dim: 64
  #     output_dim: 128
  #     dropout: 0.1


  sugar:
    id: 3
    name: "Sugar Compounds"
    description: "Sugar type discrimination (D-Galactose, D-Glucose, D-Fructose)"
    data_path: "data/sugar"
    num_files: 4

    file_list:
      - name: "Sugar_DGalactose_DGlucose_DFructose_SWIR_3505_3050_us_2x_2016-04-01T214154_raw2_rad.hdr"
        crop_region:
          top: 1255
          bottom: 2589
          left: 0
          right: 320
        variance_threshold: 0.03
        wavelength_range: [980, 1800]

      - name: "Sugar_DGalactose_DGlucose_DFructose_WTReihe_SWIR_3505_3050_us_2x_2016-04-01T220840_raw2_rad.hdr"
        crop_region:
          top: 1255
          bottom: 3179
          left: 0
          right: 320
        variance_threshold: 0.03
        wavelength_range: [980, 1800]

      - name: "WTReihe_WTQ2_SWIR_3122_4000_us_1x_2016-04-01T145834_raw2_rad.hdr"
        crop_region:
          top: 556
          bottom: 1189
          left: 15
          right: 320
        variance_threshold: 0.02
        wavelength_range: [980, 1800]

      - name: "Sugar_DMannitol_DSorbitol_S170_SWIR_3505_3050_us_2x_2016-04-01T215033_raw2_rad.hdr"
        crop_region:
          top: 1221
          bottom: 2661
          left: 15
          right: 320
        variance_threshold: 0.02
        wavelength_range: [980, 1800]

    spectral_range: [967.18, 2499.30]
    num_bands: 256
    image_size: [2589, 320]
    key_wavelengths: [1450, 1900, 2100]

    data_type: "uint16"
    value_range: [0, 65535]
    typical_mean: 10816.0
    typical_std: 10973.0

    normalize_uint16: true

    masking_wavelength_range:
      enabled: true
      wavelength_range: [980, 1800]

    min_useful_ratio: 0.35

    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1



  paper:
    id: 4
    name: "Historical Manuscripts"
    description: "Manuscript analysis and authentication"
    data_path: "data/papertrails"
    num_files: 2
    
    # IMPORTANT: Different spectral range and bands!
    spectral_range: [952.19, 2516.24]
    num_bands: 288  # NOTE: 288 bands, not 256!
    image_size: [779, 384]  # NOTE: Different width (384, not 320)!
    key_wavelengths: [1300, 1700, 2200]
    
    data_type: "float32"
    value_range: [0.0, 0.037]
    typical_mean: 0.0095
    typical_std: 0.0068
    
    crop_region:
      top: 50
      bottom: 779
      left: 0
      right: 384
    variance_threshold: 0.01

    masking_wavelength_range:
      enabled: true
      wavelength_range: [980, 2200]
    
    variance_threshold: 0.01
    min_useful_ratio: 0.28
    
    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1

  branches:
    id: 5
    name: "Tree Branch Analysis"
    description: "Spectral analysis of tree branches for species classification and health assessment"
    data_path: "data/branch"
    num_files: 1

    # Spectral characteristics (similar to paper domain)
    spectral_range: [952.19, 2516.24]
    num_bands: 288  # Matches paper domain
    image_size: [779, 384]  # Full image dimensions

    key_wavelengths: [1200, 1600, 2100]  # Typical vegetation absorption features

    # Data characteristics
    data_type: "float32"
    value_range: [0.0, 0.04]
    typical_mean: 0.011
    typical_std: 0.007

    # Use full image — no cropping
    crop_region:
      top: 95
      bottom: 732
      left: 0
      right: 310

    variance_threshold: 0.01

    masking_wavelength_range:
      enabled: true
      wavelength_range: [980, 2200]

    variance_threshold: 0.01
    min_useful_ratio: 0.28

    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1

  pottery_full:
    id: 6
    name: "Ancient Pottery (Full Image)"
    description: "Full-frame analysis of archaeological pottery for composition and dating"
    data_path: "data/archiology_full"
    num_files: 6

    spectral_range: [967.18, 2499.30]
    num_bands: 256
    image_size: [390, 320]  # Use full image dimensions

    key_wavelengths: [1500, 2000, 2300]

    data_type: "uint16"
    value_range: [0, 65535]
    typical_mean: 3176.0
    typical_std: 6138.0

    normalize_uint16: true

    # Use entire image — no cropping
    crop_region:
      top: 73
      bottom: 413
      left: 0
      right: 320

    variance_threshold: 0.01

    masking_wavelength_range:
      enabled: true
      wavelength_range: [1200, 2200]

    variance_threshold: 0.01
    min_useful_ratio: 0.25

    adapter:
      input_dim: 128
      hidden_dim: 64
      output_dim: 128
      dropout: 0.1


# =============================================================================
# IMPORTANT NOTES
# =============================================================================

# Data Type Handling:
# - Coffee, Grapes, Paper: float32, already in [0, 2] or [0, 0.037] range
# - Pottery, Sugar: uint16, need normalization to [0, 1]
#
# Spectral Band Differences:
# - Coffee, Grapes, Pottery, Sugar: 256 bands
# - Paper: 288 bands (DIFFERENT!)
#   → Need to handle this in model architecture or preprocessing
#
# Image Size Differences:
# - Coffee, Grapes, Pottery, Sugar: Width = 320
# - Paper: Width = 384 (DIFFERENT!)
#   → Patches will still be 16×16, so this is OK


# =============================================================================
# PATCH EXTRACTION SETTINGS
# =============================================================================

patch_extraction:
  patch_size: [16, 16]  # Spatial dimensions
  stride: 8  # 50% overlap for more patches
  min_valid_pixels: 128  # At least 50% non-background pixels
  
  # Morphological operations for mask cleanup
  morphology:
    erosion_iterations: 2
    dilation_iterations: 2


# =============================================================================
# DATA AUGMENTATION SETTINGS
# =============================================================================

augmentation:
  # Spatial augmentations
  spatial:
    random_rotation: true
    rotation_angles: [0, 90, 180, 270]
    random_flip_horizontal: true
    random_flip_vertical: true
    random_crop: false
  
  # Spectral augmentations
  spectral:
    spectral_dropout:
      enabled: true
      dropout_prob: 0.15  # Drop 15% of bands
    
    spectral_noise:
      enabled: true
      noise_std: 0.01
    
    spectral_shift:
      enabled: false  # Disabled (wavelength calibration is consistent)
      max_shift: 2
    
    band_shuffle:
      enabled: false  # Disabled (too aggressive)
      shuffle_window: 10


# =============================================================================
# NORMALIZATION SETTINGS
# =============================================================================

normalization:
  method: "standardization"  # Options: standardization, min_max, robust
  
  # Handle different data types
  convert_uint16_to_float: true
  uint16_normalize_method: "divide_max"  # Divide by 65535
  
  # Global statistics (will be computed from data)
  global:
    mean: null
    std: null
  
  per_domain: false


# =============================================================================
# SPECTRAL BAND ALIGNMENT (IMPORTANT!)
# =============================================================================

spectral_alignment:
  # Paper domain has 288 bands, others have 256
  # Options: 'interpolate', 'crop', 'pad'
  method: "crop"  # Crop paper to 256 bands (most common)
  target_bands: 256


# =============================================================================
# OUTPUT PATHS
# =============================================================================

output:
  processed_data_dir: "data_processed"
  patches_dir: "data_patches_pca"
  # patches_dir: "data_patches"
  metadata_file: "data_processed/metadata.json"
  stats_file: "data_patches/patch_stats.json"


# =============================================================================
# DATASET SPLIT (for evaluation, not pretraining)
# =============================================================================

splits:
  train: 0.8
  val: 0.1
  test: 0.1
  seed: 42
